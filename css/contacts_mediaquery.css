/*
  Contacts responsive rules
  - Up to 400px: sidebar takes full width.
  - Contact details open as full-screen overlay (white background) and hide sidebar.
*/



@media (max-width: 700px) {

  main.content .contacts_sidebar .contacts_sidebar_add {
    display: none;
  }

 
  body.contacts-page:not(.contacts-overlay-open) .contacts_sidebar_add_fab {
    position: fixed;
    right: 16px;
    bottom: 122px; 
    width: 56px;
    height: 56px;
    background: #2A3647;
    border: 1px solid #ffffff;
    border-radius: 56px;
    z-index: 1100;
    box-sizing: border-box;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    padding: 0;
  }

  body.contacts-page:not(.contacts-overlay-open) .contacts_sidebar_add_fab img {
    width: 26px;
    height: 26px;
    display: block;
  }

 
  main.content .contacts_sidebar {
    /* Sidebar becomes full width on mobile */
    /* Keep it constrained so it behaves like the main page column */
    /* Height uses viewport units so it fits without weird scrolling */
    width: 100%;
    min-width: 100%;
    max-width: 100%;
    border-right: none;
    position: relative;
    max-height: none;
    height: calc(100dvh - 110px); 
  }

 
  .contact_detail_header,
  .contact_detail_root {
    display: none;
  }

  body.contacts-page.contacts-overlay-open {
    overflow: hidden;
  }

 
  body.contacts-page.contacts-overlay-open header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1101; 
  }


  body.contacts-page.contacts-overlay-open main.content .contacts_sidebar {
    display: none;
  }

 
  body.contacts-page.contacts-overlay-open .contact_detail_header {
    /* Mobile overlay header: fixed + grid so title/back/subline align nicely */
    /* White background to feel like a separate "page" on small screens */
    /* High z-index so it stays above the scrollable details area */
    display: grid;
    position: fixed;
    top: 96px;
    left: 0 !important;
    right: 0;
    
    grid-template-columns: 1fr auto;
    grid-template-rows: auto auto auto;
    align-items: center;
    padding: 10px 14px;
    box-sizing: border-box;
    background: #ffffff;
    border-bottom: 1px solid rgba(0,0,0,.08);
    z-index: 1000;
    row-gap: 4px;
    column-gap: 10px;
  }


  body.contacts-page.contacts-overlay-open .cdh_title {
    /* Big contact name in the overlay header */
    /* Tight line-height so it doesn't waste vertical space */
    /* No margin so the grid spacing controls layout */
    grid-row: 1;
    grid-column: 1;
    margin: 0;
    font-size: 47px;
    line-height: 1.1;
  }

  body.contacts-page.contacts-overlay-open .contacts_overlay_back {
    /* Tap-friendly back button, no default button styling */
    /* Center the icon so it feels like a native header control */
    /* Transparent background to blend into the header */
    grid-row: 1;
    grid-column: 2;
    border: none;
    background: transparent;
    padding: 6px 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  body.contacts-page.contacts-overlay-open .contacts_overlay_back_icon {
    /* Keep the back icon consistent and crisp */
    /* Block display prevents weird inline spacing */
    width: 26px;
    height: 26px;
    display: block;
  }


  body.contacts-page.contacts-overlay-open .cdh_sub {
    /* Subtitle sits under the title and spans full width */
    /* Slight opacity so it reads as secondary info */
    /* Allow wrapping so long text doesn't overflow */
    grid-row: 2;
    grid-column: 1 / -1;
    display: block;
    font-size: 20px;
    opacity: .7;
    white-space: normal;
  }

  body.contacts-page.contacts-overlay-open .cdh_line {
    /* Small accent line for visual hierarchy */
    /* Fixed width so it looks intentional (not full-bleed) */
    /* Slight radius to match the design language */
    grid-row: 3;
    grid-column: 1 / -1;
    display: block;
    width: 92px;
    height: 3px;
    background: #29ABE2;
    border-radius: 2px;
    margin-top: -2px;
  }


  body.contacts-page.contacts-overlay-open .contact_detail_root {
    /* Details area becomes a scrollable "page" below the fixed header */
    /* Fixed positioning prevents the background/sidebar from scrolling */
    /* White background keeps focus on the contact information */
    display: flex;
    position: fixed;
    /* below the 3-row overlay header */
    top: 190px;
    left: 0 !important;
    right: 0;
    bottom: 96px;
    width: 100%;
    max-width: none;
    padding: 14px;
    box-sizing: border-box;
    background: #ffffff;
    overflow-y: auto;
    z-index: 1000;
  }

  /* Avatar in overlay should be smaller on very small screens */
  body.contacts-page.contacts-overlay-open .detail_avatar {
    width: 80px;
    height: 80px;
    min-width: 80px;
    min-height: 80px;
    font-size: 27px;
  }

  /* Bottom-right circular placeholder for a future SVG */
  body.contacts-page.contacts-overlay-open .contacts_overlay_fab {
    /* Floating action button stays reachable with the thumb */
    /* Sits above bottom navigation and above overlay content */
    /* Rounded + centered so any icon looks balanced */
    position: fixed;
    right: 16px;
   
    bottom: 122px; /* above bottom nav */
   
    width: 56px;
    height: 56px;
    background: #2A3647;
    border: 1px solid #ffffff;
    border-radius: 56px;
    z-index: 1102; /* above header/overlay; modal backdrop is raised on mobile so this sits behind the dialog */
    box-sizing: border-box;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* 3-dots icon inside the FAB */
  body.contacts-page.contacts-overlay-open .contacts_overlay_fab img{
    width: 22px;
    height: 22px;
    display: block;
  }

  /* Hide inline Edit/Delete actions on very small screens.
     They will be provided via the FAB menu instead. */
  body.contacts-page.contacts-overlay-open .detail_actions .detail_edit,
  body.contacts-page.contacts-overlay-open .detail_actions .detail_delete {
    display: none;
  }

  /* FAB menu (opens from the right, no background dimming) */
  body.contacts-page .contacts_fab_menu {
    /* Small slide-in menu anchored to the FAB */
    /* Starts off-screen to the right, then transitions into place */
    /* Pointer-events disabled while hidden so it doesn't block taps */
    position: fixed;
    right: 8px;
    bottom: 120px; /* sits above the 56px FAB (bottom:122px) + 8px gap */
    width: 100px;
    height: 116px;
    background: #ffffff;
    border-radius: 14px;
    box-shadow: 0 8px 22px rgba(0,0,0,.18);
    z-index: 1103;
    box-sizing: border-box;
    padding: 10px 8px;
    /* Keep the menu in the render tree so transitions can animate.
       (display:none -> display:flex would skip the slide-in animation.) */
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 8px;
    transform: translateX(140px);
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transition: transform 180ms ease, opacity 180ms ease, visibility 0s linear 180ms;
    will-change: transform, opacity;
  }

  body.contacts-page.contacts-fab-menu-open .contacts_fab_menu {
    /* When open: slide into view and become clickable */
    /* Visibility transition removes the delay so it feels instant */
    /* Keeps the same timing so the animation looks consistent */
    transform: translateX(0);
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    transition: transform 180ms ease, opacity 180ms ease, visibility 0s;
  }

  /* Ensure the menu's items look tappable and stack vertically */
  body.contacts-page .contacts_fab_menu .detail_edit,
  body.contacts-page .contacts_fab_menu .detail_delete {
    /* Bigger tap targets + spacing for thumbs */
    /* Flex layout keeps icon and label aligned */
    /* Slight radius so it matches the menu container */
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 6px;
    border-radius: 10px;
    cursor: pointer;
    user-select: none;
  }

  body.contacts-page .contacts_fab_menu .detail_edit:active,
  body.contacts-page .contacts_fab_menu .detail_delete:active {
    background: rgba(0,0,0,.06);
  }

  body.contacts-page .contacts_fab_menu .detail_action_icon {
    width: 18px;
    height: 18px;
  }

  /* No slide-in-from-right on mobile overlay (feels like a new page) */
  body.contacts-page.contacts-overlay-open .contact_detail_item.slide_in_right {
    animation: none !important;
    transform: none !important;
    opacity: 1 !important;
  }

  

  body.contacts-page .contacts_modal{
    /* Dialog sizing on very small screens (<=400px)
       Height is proportional to the viewport and remains stable on mobile browsers
       thanks to the JS-updated CSS var --vh (= 1% of innerHeight). */

    width: min(92vw, 360px);
    max-width: 92vw;
    transform: translateY(-3vh);

    --contacts-modal-vh: 3;

    height: calc(var(--vh, 1vh) * var(--contacts-modal-vh));
    max-height: calc(var(--vh, 1vh) * var(--contacts-modal-vh));
    min-height: calc(var(--vh, 1vh) * 70);

    border-radius: 18px;
    overflow: hidden; /* avatar overlaps within */
  }

  /* Ensure the Add/Edit dialog is always above the mobile overlay FAB.
     (The FAB should remain in the background while the dialog is open.) */
  body.contacts-page .contacts_modal_backdrop{
    /* Backdrop sits above everything on mobile so the dialog is always clickable */
    /* Top padding pushes the dialog down into a comfortable reach zone */
    /* Using flex-start prevents the dialog from being vertically centered */
    z-index: 1200;
        align-items: flex-start;          /* statt center */
    padding-top: clamp(16px, 66vh, 90px);
    padding-bottom: 16px;
    box-sizing: border-box;
  }

  body.contacts-page .contacts_modal_content{

    --contacts-left-panel-h: 38%;
    --contacts-avatar-size: clamp(76px, 24vw, 96px);

    flex-direction:column;
    align-items:stretch;
    justify-content:flex-start;
    height:100%;
    position:relative;
    padding:0;
    margin-top: 0;
    transform: none;
  }

  /* top panel */
  body.contacts-page .contacts_modal_left_panel{
    /* Left panel becomes the top section on mobile */
    /* Uses a fixed percentage height so the layout is predictable */
    /* Allows the avatar to overlap into the bottom (white) panel */
    width:100%;
    flex: 0 0 var(--contacts-left-panel-h);
    height: auto;
    justify-content: center !important;
    /* Center the headline/subtitle horizontally on very small screens */
    align-items:center !important;
  
    padding:
      clamp(0px, 4vh, 32px)
      20px
      clamp(36px, 7vh, 56px)
      20px !important;
    box-sizing:border-box;
    position:relative;
    overflow: visible; /* allow avatar to overlap into the white panel */
  }


  body.contacts-page .contacts_modal_left_panel .contacts_modal_title,
  body.contacts-page .contacts_modal_left_panel .contacts_modal_subtitle{
    /* Force full width so text-align center actually centers nicely */
    /* Keeps title/subtitle stacked and readable */
    /* Prevents weird narrow columns on small phones */
    width: 100%;
    text-align: center;
  }

  /* Action buttons (Delete / Create) centered on very small screens.
     Height stays unchanged; we only adjust alignment. */
  body.contacts-page .contacts_modal_actions{
    /* Center actions so the dialog feels balanced on tiny screens */
    /* Wrap enables buttons to break to a new line if needed */
    /* Align-items keeps vertical spacing consistent */
    width: 100%;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
  }

  /* Hide logo at <= 400px */
  body.contacts-page .contacts_modal_logo{
    display:none !important;
  }

  /* bottom panel */
  body.contacts-page .contacts_modal_right_panel{
    /* Right panel becomes the bottom content area */
    /* Extra top padding makes room for the overlapping avatar */
    /* Scroll enabled so long forms still work on small screens */
    width:100%;
    flex:1;
    justify-content:flex-start;

    padding:calc(var(--contacts-avatar-size) / 2 + 36px) 24px 24px 24px;
    box-sizing:border-box;
    overflow:auto;
  }


  body.contacts-page .contacts_modal_left_panel .contacts_modal_avatar_col{
    /* Avatar column is centered and overlaps the panel boundary */
    /* Pointer-events off so it doesn't block clicks on nearby controls */
    /* z-index keeps it above both panels visually */
    position:absolute;
    left:50%;
    bottom:0;
    transform:translate(-50%, 50%); /* center sits on the panel edge */
    height:auto;
    padding:0;
    z-index:2;
    pointer-events:none; /* purely decorative */
  }

  /* safety: if JS didn't move avatar into the left panel, keep old behavior */
  body.contacts-page .contacts_modal_content > .contacts_modal_avatar_col{
    position:absolute;
    left:50%;
    top: var(--contacts-left-panel-h);
    transform:translate(-50%,-50%);
    height:auto;
    padding:0;
    z-index:2;
  }

  body.contacts-page .contacts_modal_avatar_slot .detail_avatar,
  body.contacts-page .contacts_modal_avatar_slot .contacts_modal_avatar_image{
    width:var(--contacts-avatar-size);
    height:var(--contacts-avatar-size);
  }

  /* Close button: top-right inside the left panel (moved by JS on mobile) */
  body.contacts-page .contacts_modal_left_panel .contacts_modal_close{
    /* Keep close button reachable and consistent with native dialogs */
    /* White color for contrast on the dark/colored left panel */
    /* High z-index so it stays above the avatar overlap */
    position:absolute;
    top:16px;
    right:16px;
    color:#ffffff;
    font-size:28px;
    z-index:3;
  }

  /* The original header inside the right panel is not needed visually on mobile */
  body.contacts-page .contacts_modal_right_panel .contacts_modal_header{
    display:none;
  }

}



@media (max-width: 700px) {
  .contacts_modal_left_panel {
    /* Stack modal header content vertically on mobile */
    /* Center it vertically so it feels like a hero section */
    /* Text stays left-aligned for a cleaner form-like look */
    display: flex;
    flex-direction: column;
    justify-content: center;
    text-align: left;
  }

  .contacts_modal_actions {
    /* Keep actions centered but start them at the top edge */
    /* Flex makes spacing consistent across devices */
    /* Align-items flex-start avoids awkward vertical centering */
    display: flex;
    justify-content: center;
    align-items: flex-start;
  }

  .detail_section_label{
    /* Slightly larger label size for readability on phones */
    /* Helps section headers stand out in the form */
    /* Keeps the hierarchy clear without bolding everything */
    font-size: 20px;
  }
}


/* Ensure d_none always wins over component display rules */
.d_none { display: none !important; }
